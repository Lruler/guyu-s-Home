<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.61">
    <script>
      (function() {
        const userMode = localStorage.getItem('vuepress-reco-color-scheme') || 'auto';
        const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (userMode === 'dark' || (userMode === 'auto' && systemDarkMode)) {
          document.documentElement.classList.toggle('dark', true);
        }
      })();
    </script>
    <link rel="icon" href="./logo.png"><title>WebSocket | 谷雨小栈</title><meta name="description" content="我的一些生活切片">
    <link rel="modulepreload" href="/guyu.inn/assets/app-5c2eab03.js"><link rel="modulepreload" href="/guyu.inn/assets/framework-1749bed7.js"><link rel="modulepreload" href="/guyu.inn/assets/ws.html-a4f1ee22.js"><link rel="modulepreload" href="/guyu.inn/assets/ws.html-f21fca11.js"><link rel="prefetch" href="/guyu.inn/assets/index.html-6d5e9dd3.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/index.html-ab097b1e.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/ai.html-a6d6d502.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/database.html-ecf43c05.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/base.html-b953fa6d.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/browser.html-d92f4b64.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/canvas.html-59d1ef4e.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/css-base.html-2cb1dafc.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/css-tool.html-c3406d08.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/designMode.html-2601d84d.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/esm.html-cf18d583.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/html.html-baba164b.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/http-base.html-02f1350d.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/js-base.html-616fd2a5.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/js-practice.html-c4ca7d62.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/logic.html-f3e534d9.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/network.html-d5555fa1.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/node-base.html-1a1d1807.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/node-frame.html-7d5a3790.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/optimization.html-1bb7da03.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/packageManager.html-e7296821.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/pwa.html-bbfee5ed.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/react.html-85d7fa8d.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/scene.html-2190d63d.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/ssr.html-cbaa2746.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/tcp.html-f6b26556.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/tencent.html-d664718f.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/ts-base.html-01de89c1.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/ts-practice.html-70e254a0.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/vite.html-3719828d.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/vue.html-52703ab1.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/webpack.html-466121a5.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/devops.html-48b240d9.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/404.html-60b35caa.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/index.html-63b2c6d6.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/index.html-88455b41.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/ai.html-b54a67bc.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/database.html-d25a0bd4.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/base.html-d248029a.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/browser.html-d29951a1.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/canvas.html-f4ed77c8.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/css-base.html-f50b914f.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/css-tool.html-4e9ab78a.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/designMode.html-371f8739.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/esm.html-5108f374.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/html.html-029f7950.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/http-base.html-4222efc8.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/js-base.html-999f91f7.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/js-practice.html-7e47f78b.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/logic.html-b8814052.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/network.html-6511086c.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/node-base.html-391ffb82.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/node-frame.html-91a19c50.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/optimization.html-dbbb6a13.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/packageManager.html-5eb25c11.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/pwa.html-1c700e74.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/react.html-a22025d5.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/scene.html-08796381.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/ssr.html-c6893772.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/tcp.html-b10bb9e9.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/tencent.html-be16d1b3.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/ts-base.html-5993c65d.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/ts-practice.html-7be565f9.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/vite.html-adee8657.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/vue.html-aa0d9727.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/webpack.html-8789ba6a.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/devops.html-f225b1cb.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/404.html-1c7b349e.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/reco-valine-a0c1af1f.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/style-e9220a04.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/docsearch-1d421ddb.js" as="script"><link rel="prefetch" href="/guyu.inn/assets/index-ade63bb5.js" as="script">
    <link rel="preload" href="/guyu.inn/assets/style-28490fbc.css" as="style"><link rel="stylesheet" href="/guyu.inn/assets/style-28490fbc.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><div class="common-wrapper show-series show-catalog"><div><header class="navbar-container"><!--[--><div class="site-brand nav-item"><img class="logo" src="/guyu.inn/logo.png" alt="谷雨小栈"><a href="/guyu.inn/" class="site-name can-hide">谷雨小栈</a></div><div class="nav-item navbar-links-wrapper" style=""><div><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav class="navbar-links"><!--[--><div class="navbar-links__item"><a href="/guyu.inn/" class="link router-link-active" aria-label="主页"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->主页<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/guyu.inn/docs/fe/html" class="link" aria-label="前端"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->前端<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/guyu.inn/docs/be/database" class="link" aria-label="后端"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->后端<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/guyu.inn/docs/ops/devops" class="link" aria-label="运维"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->运维<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/guyu.inn/docs/algorithm/base" class="link" aria-label="算法"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->算法<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/guyu.inn/docs/ai/ai" class="link" aria-label="人工智能"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->人工智能<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="我的江湖"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->我的江湖<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="我的江湖"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->我的江湖<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><li class="dropdown-link__item"><a class="link" href="https://github.com/Lruler" target="_blank" rel="noopener noreferrer" aria-label="github"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->github<!--]--></span></span><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a class="link" href="http://forum.muxixyz.com/" target="_blank" rel="noopener noreferrer" aria-label="茶馆"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->茶馆<!--]--></span></span><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a class="link" href="https://space.bilibili.com/628418245?spm_id_from=333.1007.0.0" target="_blank" rel="noopener noreferrer" aria-label="bilibili"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->bilibili<!--]--></span></span><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><span class="xicon-container btn-toggle-dark-mode btn--dark-mode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:inherit;"><path d="M15 2h2v3h-2z" fill="currentColor"></path><path d="M27 15h3v2h-3z" fill="currentColor"></path><path d="M15 27h2v3h-2z" fill="currentColor"></path><path d="M2 15h3v2H2z" fill="currentColor"></path><path d="M5.45 6.884l1.414-1.415l2.121 2.122l-1.414 1.414z" fill="currentColor"></path><path d="M23 7.58l2.121-2.12l1.414 1.414l-2.121 2.121z" fill="currentColor"></path><path d="M23.002 24.416l1.415-1.414l2.12 2.122l-1.413 1.414z" fill="currentColor"></path><path d="M5.47 25.13L7.59 23L9 24.42l-2.12 2.12l-1.41-1.41z" fill="currentColor"></path><path d="M16 8a8 8 0 1 0 8 8a8 8 0 0 0-8-8zm0 14a6 6 0 0 1 0-12z" fill="currentColor"></path></svg></span><span class="xicon-container btn-toggle-menus"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:inherit;"><circle cx="16" cy="8" r="2" fill="currentColor"></circle><circle cx="16" cy="16" r="2" fill="currentColor"></circle><circle cx="16" cy="24" r="2" fill="currentColor"></circle></svg></span></div><!--]--></header><div class="mobile-menus-container"><nav class="navbar-links mobile"><!--[--><div class="navbar-links__item"><a href="/guyu.inn/" class="link router-link-active" aria-label="主页"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->主页<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/guyu.inn/docs/fe/html" class="link" aria-label="前端"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->前端<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/guyu.inn/docs/be/database" class="link" aria-label="后端"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->后端<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/guyu.inn/docs/ops/devops" class="link" aria-label="运维"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->运维<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/guyu.inn/docs/algorithm/base" class="link" aria-label="算法"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->算法<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/guyu.inn/docs/ai/ai" class="link" aria-label="人工智能"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->人工智能<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="我的江湖"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->我的江湖<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="我的江湖"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->我的江湖<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><li class="dropdown-link__item"><a class="link" href="https://github.com/Lruler" target="_blank" rel="noopener noreferrer" aria-label="github"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->github<!--]--></span></span><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a class="link" href="http://forum.muxixyz.com/" target="_blank" rel="noopener noreferrer" aria-label="茶馆"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->茶馆<!--]--></span></span><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a class="link" href="https://space.bilibili.com/628418245?spm_id_from=333.1007.0.0" target="_blank" rel="noopener noreferrer" aria-label="bilibili"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->bilibili<!--]--></span></span><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><div class="appearance"><span>Appearance</span><span class="xicon-container btn-toggle-dark-mode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:inherit;"><path d="M15 2h2v3h-2z" fill="currentColor"></path><path d="M27 15h3v2h-3z" fill="currentColor"></path><path d="M15 27h2v3h-2z" fill="currentColor"></path><path d="M2 15h3v2H2z" fill="currentColor"></path><path d="M5.45 6.884l1.414-1.415l2.121 2.122l-1.414 1.414z" fill="currentColor"></path><path d="M23 7.58l2.121-2.12l1.414 1.414l-2.121 2.121z" fill="currentColor"></path><path d="M23.002 24.416l1.415-1.414l2.12 2.122l-1.413 1.414z" fill="currentColor"></path><path d="M5.47 25.13L7.59 23L9 24.42l-2.12 2.12l-1.41-1.41z" fill="currentColor"></path><path d="M16 8a8 8 0 1 0 8 8a8 8 0 0 0-8-8zm0 14a6 6 0 0 1 0-12z" fill="currentColor"></path></svg></span></div></div><div class="series-mask"></div><aside class="series-container"><div class="site-brand"><img class="logo" src="/guyu.inn/logo.png" alt="谷雨小栈"><a href="/guyu.inn/" class="site-name can-hide">谷雨小栈</a></div><!--[--><!--[--><a href="/guyu.inn/docs/fe/html.html" class="link series-item" aria-label="HTML"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->HTML<!--]--></span></span><!--[--><!--]--></a><!--]--><!--[--><a href="/guyu.inn/docs/fe/browser.html" class="link series-item" aria-label="浏览器"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->浏览器<!--]--></span></span><!--[--><!--]--></a><!--]--><!--[--><a href="/guyu.inn/docs/fe/optimization.html" class="link series-item" aria-label="性能优化"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->性能优化<!--]--></span></span><!--[--><!--]--></a><!--]--><!--[--><a href="/guyu.inn/docs/fe/designMode.html" class="link series-item" aria-label="设计模式"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->设计模式<!--]--></span></span><!--[--><!--]--></a><!--]--><!--[--><a href="/guyu.inn/docs/fe/scene.html" class="link series-item" aria-label="场景题"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->场景题<!--]--></span></span><!--[--><!--]--></a><!--]--><!--[--><a href="/guyu.inn/docs/fe/tencent.html" class="link series-item" aria-label="腾讯实习"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->腾讯实习<!--]--></span></span><!--[--><!--]--></a><!--]--><!--[--><section class="series-group series-item"><h5 class="series-heading">CSS篇</h5><ul><li><!--[--><a href="/guyu.inn/docs/fe/css-base.html" class="link series-item" aria-label="CSS基础知识"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->CSS基础知识<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/guyu.inn/docs/fe/css-tool.html" class="link series-item" aria-label="CSS工具"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->CSS工具<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--><!--[--><section class="series-group series-item"><h5 class="series-heading">JavaScript篇</h5><ul><li><!--[--><a href="/guyu.inn/docs/fe/js-base.html" class="link series-item" aria-label="JS基础知识"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->JS基础知识<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/guyu.inn/docs/fe/js-practice.html" class="link series-item" aria-label="JS实践"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->JS实践<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/guyu.inn/docs/fe/canvas.html" class="link series-item" aria-label="Canvas学习"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->Canvas学习<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--><!--[--><section class="series-group series-item"><h5 class="series-heading">TypeScript篇</h5><ul><li><!--[--><a href="/guyu.inn/docs/fe/ts-base.html" class="link series-item" aria-label="Ts基础知识"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->Ts基础知识<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/guyu.inn/docs/fe/ts-practice.html" class="link series-item" aria-label="Ts应用"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->Ts应用<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--><!--[--><section class="series-group series-item"><h5 class="series-heading">Node篇</h5><ul><li><!--[--><a href="/guyu.inn/docs/fe/node-base.html" class="link series-item" aria-label="Node基础知识"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->Node基础知识<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/guyu.inn/docs/fe/node-frame.html" class="link series-item" aria-label="Node框架"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->Node框架<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--><!--[--><section class="series-group series-item"><h5 class="series-heading active">计算机网络篇</h5><ul><li><!--[--><a href="/guyu.inn/docs/fe/http-base.html" class="link series-item" aria-label="HTTP基础"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->HTTP基础<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/guyu.inn/docs/fe/tcp.html" class="link series-item" aria-label="TCP基础"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->TCP基础<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a aria-current="page" href="/guyu.inn/docs/fe/ws.html" class="router-link-active router-link-exact-active link router-link-active series-item active" aria-label="WebSocket"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->WebSocket<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--><!--[--><section class="series-group series-item"><h5 class="series-heading">前端框架篇</h5><ul><li><!--[--><a href="/guyu.inn/docs/fe/react.html" class="link series-item" aria-label="React"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->React<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/guyu.inn/docs/fe/vue.html" class="link series-item" aria-label="Vue"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->Vue<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--><!--[--><section class="series-group series-item"><h5 class="series-heading">工具篇</h5><ul><li><!--[--><a href="/guyu.inn/docs/fe/esm.html" class="link series-item" aria-label="es moudle与commonJS"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->es moudle与commonJS<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/guyu.inn/docs/fe/vite.html" class="link series-item" aria-label="Vite"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->Vite<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/guyu.inn/docs/fe/webpack.html" class="link series-item" aria-label="Webpack"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->Webpack<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/guyu.inn/docs/fe/packageManager.html" class="link series-item" aria-label="包管理器"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->包管理器<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--><!--[--><section class="series-group series-item"><h5 class="series-heading">零碎知识点</h5><ul><li><!--[--><a href="/guyu.inn/docs/fe/ssr.html" class="link series-item" aria-label="ssr"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->ssr<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/guyu.inn/docs/fe/pwa.html" class="link series-item" aria-label="pwa"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->pwa<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/guyu.inn/docs/fe/logic.html" class="link series-item" aria-label="智力题"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->智力题<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--><!--]--></aside><!--[--><main class="page-container"><h1 class="page-title">WebSocket</h1><div class="page-info"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:inherit;"><path d="M16 4a5 5 0 1 1-5 5a5 5 0 0 1 5-5m0-2a7 7 0 1 0 7 7a7 7 0 0 0-7-7z" fill="currentColor"></path><path d="M26 30h-2v-5a5 5 0 0 0-5-5h-6a5 5 0 0 0-5 5v5H6v-5a7 7 0 0 1 7-7h6a7 7 0 0 1 7 7z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->谷雨<!--]--></span></span><!----><!----><!----><!----></div><div class="theme-reco-default-content"><div><h2 id="websocket-实现聊天" tabindex="-1"><a class="header-anchor" href="#websocket-实现聊天" aria-hidden="true">#</a> WebSocket 实现聊天</h2><p>端口: 80 443</p><ul><li><p>创建 WebSocket 连接 -&gt; <code>new WebSocket(url)</code></p></li><li><p>常量 <code>CONNECTING -&gt; 0</code>、<code>OPEN -&gt; 1</code>、<code>CLOSING -&gt; 2</code>、<code>CLOSED -&gt; 3</code></p></li><li><p><code>WebSocket.onopen</code> -&gt; 连接成功，开始通讯</p></li><li><p><code>WebSocket.onmessage</code> -&gt; 客户端接收服务端发送的消息</p></li><li><p><code>WebSocket.onclose</code> -&gt; 连接关闭后的回调函数</p></li><li><p><code>WebSocket.onerror</code> -&gt; 连接失败后的回调函数</p></li><li><p><code>WebSocket.readyState</code> -&gt; 当前的连接状态</p></li><li><p><code>WebSocket.close</code> -&gt; 关闭当前连接</p></li><li><p><code>WebSocket.send</code> -&gt; 客户端向服务端发送消息</p></li></ul><p>当刷新浏览器或关闭浏览器时，应断开与服务端的连接。</p><p>若浏览器与服务器断开连接，则进行重连，我们每 5s 重连一次，重连一定次数依旧不能成功，则断开连接。连接成功后将 limit 限制重置。</p><p>心跳检测是客户端与服务端约定一个规则进行通讯，如若在一定时间内收不到对方的消息，则连接断开，需进行重连。由于各浏览器机制不同，触发 onclose 时机也不同，故我们需要心跳检测来补充断线重连的逻辑。</p><p>🦅 WebSocket 并不是全新协议，而是利用 HTTP 协议来建立连接，故此连接需从浏览器发起，格式如下：</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code>GET wss://api.chat.deeruby.com/ HTTP/1.1
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">api.chat.deeruby.com</span></span>
<span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">Upgrade</span></span>
<span class="token header"><span class="token header-name keyword">Upgrade</span><span class="token punctuation">:</span> <span class="token header-value">websocket</span></span>
<span class="token header"><span class="token header-name keyword">Origin</span><span class="token punctuation">:</span> <span class="token header-value">https://chat.deeruby.com</span></span>
<span class="token header"><span class="token header-name keyword">Sec-WebSocket-Version</span><span class="token punctuation">:</span> <span class="token header-value">13</span></span>
<span class="token header"><span class="token header-name keyword">Sec-WebSocket-Key</span><span class="token punctuation">:</span> <span class="token header-value">dsRxU8oSxU2Jru9hOgf4dg==</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>请求头<code>Upgrade: websocket</code>和<code>Connection: Upgrade</code>表示这个连接将要被转换为 <strong>WebSocket</strong> 连接。</p></li><li><p><code>Sec-WebSocket-Version</code>指定了 <strong>WebSocket</strong> 的协议版本，如果服务端不支持该版本，需要返回一个<code>Sec-WebSocket-Version</code>header，里面包含服务端支持的版本号。</p></li><li><p><code>Sec-WebSocket-Key</code>与服务端<code>Sec-WebSocket-Accept</code>配套，用于标识连接。</p></li></ul><p>🦅 随后，服务器若接受该请求，则做如下反应：</p><div class="language-http line-numbers-mode" data-ext="http"><pre class="language-http"><code><span class="token response-status"><span class="token http-version property">HTTP/1.1</span> <span class="token status-code number">101</span> <span class="token reason-phrase string">Switching Protocols </span></span>
<span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">upgrade </span></span>
<span class="token header"><span class="token header-name keyword">Upgrade</span><span class="token punctuation">:</span> <span class="token header-value">websocket </span></span>
<span class="token header"><span class="token header-name keyword">Sec-WebSocket-Accept</span><span class="token punctuation">:</span> <span class="token header-value">aAO8QyaRJEYUX2yG+pTEwRQK04w=</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>响应码 <strong>101</strong> 表示本次连接的 <strong>HTTP</strong> 协议将被更改，更改为 <code>Upgrade: websocket</code> 指定的 <strong>WebSocket</strong> 协议。</li><li><code>Sec-WebSocket-Accep</code> 是将 <code>Sec-WebSocket-Key</code> 跟 <code>258EAFA5-E914-47DA-95CA-C5AB0DC85B11</code> 拼接，通过 <strong>SHA1</strong> 计算并转换为 <strong>base64</strong> 字符串。浏览器使用它来确保响应与请求相对应。</li></ul><p><strong>WS中有HTTP的参与，需要先通过HTTP请求访问对方是否支持WebSocket</strong></p><blockquote><p><strong>无法模拟 WebSocket 握手</strong></p><p>我们不能使用 <code>XMLHttpRequest</code> 或 <code>fetch</code> 来进行这种 HTTP 请求，因为不允许 JavaScript 设置这些 header。</p></blockquote><h3 id="扩展和子协议" tabindex="-1"><a class="header-anchor" href="#扩展和子协议" aria-hidden="true">#</a> <a href="https://zh.javascript.info/websocket#kuo-zhan-he-zi-xie-yi" target="_blank" rel="noopener noreferrer">扩展和子协议<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h3><p>WebSocket 可能还有其他 header，<code>Sec-WebSocket-Extensions</code> 和 <code>Sec-WebSocket-Protocol</code>，它们描述了扩展和子协议。</p><p>例如：</p><ul><li><p><code>Sec-WebSocket-Extensions: deflate-frame</code> 表示浏览器支持数据压缩。扩展与传输数据有关，扩展了 WebSocket 协议的功能。<code>Sec-WebSocket-Extensions</code> header 由浏览器自动发送，其中包含其支持的所有扩展的列表。</p></li><li><p><code>Sec-WebSocket-Protocol: soap, wamp</code> 表示我们不仅要传输任何数据，还要传输 <a href="https://en.wikipedia.org/wiki/SOAP" target="_blank" rel="noopener noreferrer">SOAP<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 或 WAMP（“The WebSocket Application Messaging Protocol”）协议中的数据。WebSocket 子协议已经在 <a href="https://www.iana.org/assignments/websocket/websocket.xml" target="_blank" rel="noopener noreferrer">IANA catalogue<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 中注册。因此，此 header 描述了我们将要使用的数据格式。</p><p>这个可选的 header 是使用 <code>new WebSocket</code> 的第二个参数设置的。它是子协议数组，例如，如果我们想使用 SOAP 或 WAMP：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">&quot;wss://javascript.info/chat&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;soap&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;wamp&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><h2 id="数据传输" tabindex="-1"><a class="header-anchor" href="#数据传输" aria-hidden="true">#</a> <a href="https://zh.javascript.info/websocket#shu-ju-chuan-shu" target="_blank" rel="noopener noreferrer">数据传输<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h2><p>WebSocket 通信由 “frames”（即数据片段）组成，可以从任何一方发送，并且有以下几种类型：</p><ul><li>“text frames” —— 包含各方发送给彼此的文本数据。</li><li>“binary data frames” —— 包含各方发送给彼此的二进制数据。</li><li>“ping/pong frames” 被用于检查从服务器发送的连接，浏览器会自动响应它们。</li><li>还有 “connection close frame” 以及其他服务 frames。</li></ul><p>在浏览器里，我们仅直接使用文本或二进制 frames。</p><p><strong>WebSocket <code>.send()</code> 方法可以发送文本或二进制数据。</strong></p><p><code>socket.send(body)</code> 调用允许 <code>body</code> 是字符串或二进制格式，包括 <code>Blob</code>，<code>ArrayBuffer</code> 等。不需要额外的设置：直接发送它们就可以了。</p><p><strong>当我们收到数据时，文本总是以字符串形式呈现。而对于二进制数据，我们可以在 <code>Blob</code> 和 <code>ArrayBuffer</code> 格式之间进行选择。</strong></p><p>它是由 <code>socket.binaryType</code> 属性设置的，默认为 <code>&quot;blob&quot;</code>，因此二进制数据通常以 <code>Blob</code> 对象呈现。</p><p><a href="https://zh.javascript.info/blob" target="_blank" rel="noopener noreferrer">Blob<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 是高级的二进制对象，它直接与 <code>&lt;a&gt;</code>，<code>&lt;img&gt;</code> 及其他标签集成在一起，因此，默认以 <code>Blob</code> 格式是一个明智的选择。但是对于二进制处理，要访问单个数据字节，我们可以将其改为 <code>&quot;arraybuffer&quot;</code>：</p><h2 id="限速" tabindex="-1"><a class="header-anchor" href="#限速" aria-hidden="true">#</a> <a href="https://zh.javascript.info/websocket#xian-su" target="_blank" rel="noopener noreferrer">限速<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h2><p>想象一下：我们的应用程序正在生成大量要发送的数据。但是用户的网速却很慢，可能是在乡下的移动设备上。</p><p>我们可以反复地调用 <code>socket.send(data)</code>。但是数据将会缓冲（储存）在内存中，并且只能在网速允许的情况下尽快将数据发送出去。</p><p><code>socket.bufferedAmount</code> 属性储存了目前已缓冲的字节数，等待通过网络发送。</p><p>我们可以检查它以查看 socket 是否真的可用于传输。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 每 100ms 检查一次 socket</span>
<span class="token comment">// 仅当所有现有的数据都已被发送出去时，再发送更多数据</span>
<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>socket<span class="token punctuation">.</span>bufferedAmount <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token function">moreData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>注意，WebSocket和socket没什么联系！</strong></p><blockquote><p>Socket套接字，是由<strong>系统</strong>提供用于网络通信的技术，是基于TCP/IP协议的网络通信的基本操作单元。基于Socket套接字的网络程序开发就是网络编程。</p><p>socket是在应用层和传输层之间的一个抽象层，它把TCP/IP层复杂的操作抽象为几个简单的接口供应用层调用来实现进程在网络中通信。</p></blockquote><h2 id="浅谈sse" tabindex="-1"><a class="header-anchor" href="#浅谈sse" aria-hidden="true">#</a> 浅谈SSE</h2><h3 id="什么是sse" tabindex="-1"><a class="header-anchor" href="#什么是sse" aria-hidden="true">#</a> 什么是SSE ?</h3><p><strong>SSE 全称：Server-Sent Events</strong></p><p><strong>SSE</strong> 使用 <strong>HTTP</strong>协议，而 <strong>HTTP</strong> 协议无法由服务器主动推送消息，但有一种变通方式，即服务端向客户端声明，接下来发送的为流信息。其为一个连续发送的数据流，而不是一个一次性的数据包，故客户端不会关闭连接，而是一直等服务器发送新的数据流。<strong>SSE</strong> 就是通过这种机制，使用流信息向浏览器推送消息。</p><h3 id="什么场景选用sse" tabindex="-1"><a class="header-anchor" href="#什么场景选用sse" aria-hidden="true">#</a> 什么场景选用SSE ?</h3><p>只需要服务器给客户端发送消息的场景时，SSE可胜任</p></div></div><footer class="page-meta"><div class="meta-item edit-link"><span class="xicon-container left meta-item-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:20px;height:20px;font-size:20px;color:inherit;"><path d="M2 26h28v2H2z" fill="currentColor"></path><path d="M25.4 9c.8-.8.8-2 0-2.8l-3.6-3.6c-.8-.8-2-.8-2.8 0l-15 15V24h6.4l15-15zm-5-5L24 7.6l-3 3L17.4 7l3-3zM6 22v-3.6l10-10l3.6 3.6l-10 10H6z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->Edit this page<!--]--></span></span></div><div class="meta-item last-updated"><span class="xicon-container left meta-item-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:20px;height:20px;font-size:20px;color:inherit;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->最后更新时间 2023-08-25 06:11:04<!--]--></span></span></div></footer><nav class="page-nav"><p class="hasPrev inner"><span class="page-nav-item prev"> ← TCP基础</span><!----></p></nav><!----></main><!--]--><div class="page-catalog-container"><h5 class="tip">ON THIS PAGE</h5><ul><!--[--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/guyu.inn/docs/fe/ws.html#websocket-实现聊天" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="WebSocket 实现聊天"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->WebSocket 实现聊天<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/guyu.inn/docs/fe/ws.html#扩展和子协议" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="扩展和子协议"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->扩展和子协议<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/guyu.inn/docs/fe/ws.html#数据传输" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="数据传输"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->数据传输<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/guyu.inn/docs/fe/ws.html#限速" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="限速"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->限速<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/guyu.inn/docs/fe/ws.html#浅谈sse" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="浅谈SSE"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->浅谈SSE<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/guyu.inn/docs/fe/ws.html#什么是sse" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="什么是SSE ?"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->什么是SSE ?<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/guyu.inn/docs/fe/ws.html#什么场景选用sse" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="什么场景选用SSE ?"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->什么场景选用SSE ?<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--]--></ul></div></div></div></div><!----><!----><!--]--></div>
    <script type="module" src="/guyu.inn/assets/app-5c2eab03.js" defer></script>
  </body>
</html>
